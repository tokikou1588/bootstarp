(function(n){n.extend({bb_camera:function(t,i,r,u){var f=n(t),o=function(n,t){n.pause();n.srcObject=null;t.stop()},s,e;if(r==="stop"){s=f.find("video")[0];e=f.data("bb_video_track");e&&o(s,e);return}navigator.mediaDevices.enumerateDevices().then(function(t){var s=t.filter(function(n){return n.kind==="videoinput"});i.invokeMethodAsync("InitDevices",s).then(()=>{u&&s.length>0&&f.find('button[data-method="play"]').trigger("click")});var r=f.find("video")[0],h=f.find("canvas")[0],c=h.getContext("2d"),e;f.on("click","button[data-method]",function(){var s=n(this).attr("data-method"),t,l,u;if(s==="play"){var y=n(this).attr("data-camera"),a=f.find(".dropdown-item.active").attr("data-val"),v={video:{facingMode:y},audio:!1};a!==""&&(v.video.deviceId={exact:a});navigator.mediaDevices.getUserMedia(v).then(n=>{r.srcObject=n,r.play(),e=n.getTracks()[0],f.data("bb_video_track",e),i.invokeMethodAsync("Start")}).catch(n=>{console.log(n),i.invokeMethodAsync("GetError",n.message)})}else s==="stop"?(o(r,e),i.invokeMethodAsync("Stop")):s==="capture"&&(c.drawImage(r,0,0,300,200),t=h.toDataURL(),console.log(t),i.invokeMethodAsync("Capture"),l=f.find("img"),l.length===1&&l.attr("src",t),u=f.find("a.download"),u.attr("href",t),u.attr("download",(new Date).format("yyyyMMddHHmmss")+".png"),u[0].click())})})}})})(jQuery);